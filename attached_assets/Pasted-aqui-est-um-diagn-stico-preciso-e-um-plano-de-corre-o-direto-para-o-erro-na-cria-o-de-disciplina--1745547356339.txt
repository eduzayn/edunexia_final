aqui estÃ¡ um diagnÃ³stico preciso e um plano de correÃ§Ã£o direto para o erro na criaÃ§Ã£o de disciplina que estÃ¡ gerando status 500 Internal Server Error.

ğŸ§¨ Erro atual: duplicate key value violates unique constraint "disciplines_code_key"
ğŸ§  O que estÃ¡ acontecendo?
VocÃª estÃ¡ tentando criar uma nova disciplina com um cÃ³digo que jÃ¡ existe no banco de dados.

â¡ï¸ O campo code (cÃ³digo da disciplina) tem uma constraint de unicidade no PostgreSQL:

sql
Copiar
Editar
UNIQUE("code")
E a criaÃ§Ã£o estÃ¡ tentando inserir outro com o mesmo valor.

âœ… SoluÃ§Ãµes possÃ­veis
âœ… 1. Gerar cÃ³digo de forma realmente Ãºnica no backend
Na sua tabela disciplines, vocÃª deve garantir que o cÃ³digo seja gerado automaticamente no backend com algum tipo de sequÃªncia ou identificador Ãºnico:

ts
Copiar
Editar
// Exemplo simplificado (em Drizzle ou outro ORM)
const newCode = await generateUniqueCode(); // funÃ§Ã£o que verifica e evita duplicidade

await db.insert(disciplines).values({
  code: newCode,
  name,
  description,
  ...
});
Se jÃ¡ estiver gerando no backend, verifique se a funÃ§Ã£o de geraÃ§Ã£o de cÃ³digo estÃ¡ checando duplicidade antes de salvar.

âœ… 2. Evitar que o frontend envie code manualmente
No frontend (discipline-create-form.tsx ou similar), certifique-se de que o campo "CÃ³digo" estÃ¡ desabilitado ou oculto, e o cÃ³digo sÃ³ serÃ¡ gerado no backend:

tsx
Copiar
Editar
<input disabled placeholder="CÃ³digo serÃ¡ gerado automaticamente" />
âœ… 3. Tratar erro 500 no frontend com clareza
Atualize o try/catch no componente que chama a API (provavelmente disciplines-page.tsx) para mostrar mensagens especÃ­ficas:

ts
Copiar
Editar
catch (error) {
  const message = error.message?.includes('duplicate key')
    ? "JÃ¡ existe uma disciplina com esse cÃ³digo."
    : "Erro ao criar disciplina. Tente novamente.";

  toast.error(message);
}
ğŸ§ª RecomendaÃ§Ã£o para testar
Tente criar uma nova disciplina sem preencher o campo code (ou remova no payload via console.log).

Verifique se o backend gera o cÃ³digo automaticamente.

Veja se a disciplina aparece na listagem com um novo cÃ³digo Ãºnico.

Tente repetir â€” o erro nÃ£o deve acontecer novamente.

ğŸ“ Arquivos que devem ser revisados e protegidos apÃ³s o ajuste

Arquivo	AÃ§Ã£o
server/routes/discipline.ts	Verificar se a criaÃ§Ã£o de disciplina evita cÃ³digos duplicados.
server/controllers/discipline.controller.ts (se houver)	Garantir que gera code Ãºnico.
client/src/pages/admin/discipline-form.tsx	Desabilitar input manual de code.
client/src/pages/admin/disciplines-page.tsx	Tratar erro de duplicidade com clareza.
