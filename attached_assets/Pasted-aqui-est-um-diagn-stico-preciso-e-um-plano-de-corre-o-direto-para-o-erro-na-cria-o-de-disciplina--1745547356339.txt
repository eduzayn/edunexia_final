aqui está um diagnóstico preciso e um plano de correção direto para o erro na criação de disciplina que está gerando status 500 Internal Server Error.

🧨 Erro atual: duplicate key value violates unique constraint "disciplines_code_key"
🧠 O que está acontecendo?
Você está tentando criar uma nova disciplina com um código que já existe no banco de dados.

➡️ O campo code (código da disciplina) tem uma constraint de unicidade no PostgreSQL:

sql
Copiar
Editar
UNIQUE("code")
E a criação está tentando inserir outro com o mesmo valor.

✅ Soluções possíveis
✅ 1. Gerar código de forma realmente única no backend
Na sua tabela disciplines, você deve garantir que o código seja gerado automaticamente no backend com algum tipo de sequência ou identificador único:

ts
Copiar
Editar
// Exemplo simplificado (em Drizzle ou outro ORM)
const newCode = await generateUniqueCode(); // função que verifica e evita duplicidade

await db.insert(disciplines).values({
  code: newCode,
  name,
  description,
  ...
});
Se já estiver gerando no backend, verifique se a função de geração de código está checando duplicidade antes de salvar.

✅ 2. Evitar que o frontend envie code manualmente
No frontend (discipline-create-form.tsx ou similar), certifique-se de que o campo "Código" está desabilitado ou oculto, e o código só será gerado no backend:

tsx
Copiar
Editar
<input disabled placeholder="Código será gerado automaticamente" />
✅ 3. Tratar erro 500 no frontend com clareza
Atualize o try/catch no componente que chama a API (provavelmente disciplines-page.tsx) para mostrar mensagens específicas:

ts
Copiar
Editar
catch (error) {
  const message = error.message?.includes('duplicate key')
    ? "Já existe uma disciplina com esse código."
    : "Erro ao criar disciplina. Tente novamente.";

  toast.error(message);
}
🧪 Recomendação para testar
Tente criar uma nova disciplina sem preencher o campo code (ou remova no payload via console.log).

Verifique se o backend gera o código automaticamente.

Veja se a disciplina aparece na listagem com um novo código único.

Tente repetir — o erro não deve acontecer novamente.

📁 Arquivos que devem ser revisados e protegidos após o ajuste

Arquivo	Ação
server/routes/discipline.ts	Verificar se a criação de disciplina evita códigos duplicados.
server/controllers/discipline.controller.ts (se houver)	Garantir que gera code único.
client/src/pages/admin/discipline-form.tsx	Desabilitar input manual de code.
client/src/pages/admin/disciplines-page.tsx	Tratar erro de duplicidade com clareza.
